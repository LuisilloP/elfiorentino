---
import type { GetStaticPaths } from "astro";
import type { Product } from "../../types/Interfaces.ts";

import Layout from "../../layouts/Layout.astro";
import { dataProducts } from "../../services/getProducts";
import ArrowImage from "../../components/button/ArrowImage.astro";
import LabelCustomize from "../../components/button/LabelCustomize.astro";

const siteUrl = "https://muebleriaelfiorentino.cl";
const { id } = Astro.params;

const product: Product | undefined = dataProducts.find(
  (p) => p.slug.toString() == id,
) as Product | undefined;

if (!product) {
  throw new Error(`Producto no encontrado: ${id}`);
}

export const getStaticPaths = (() => {
  return dataProducts.map((product) => ({
    params: { id: product.slug.toString() },
  }));
}) satisfies GetStaticPaths;

const { description, price, photos, name, tones } = product;
const imageList = photos?.urls ?? [];
const galleryImages = imageList.length ? imageList : ["/indexImage/Logo.png"];
const resolveImagePath = (img: string) =>
  img.startsWith("/") || img.startsWith("http") ? img : `/productImage/${img}`;
const mapImageToAbsolute = (img: string) =>
  new URL(resolveImagePath(img), siteUrl).toString();
const mainImage = mapImageToAbsolute(galleryImages[0]);
const metaDescription =
  description.length > 155 ? `${description.slice(0, 152)}...` : description;
const showDimensions =
  id !== "cocina-personalizada" && id !== "closet-personalizado";
const shouldAskDrawers =
  id === "comoda-personalizada" ||
  (!product.type && id !== "estante-repisero" && id !== "mesones");
const isEnterprise = product.type === false;
const priceFormatter = new Intl.NumberFormat("es-CL", {
  style: "currency",
  currency: "CLP",
  maximumFractionDigits: 0,
});
const formattedPrice = priceFormatter.format(price);
const priceHeading = isEnterprise ? "Valor personalizado" : "Desde";
const priceValue = isEnterprise ? "Cotización a medida" : formattedPrice;
const priceNote = isEnterprise
  ? "Cuéntanos tu proyecto y te entregamos una cotización a medida."
  : "Asesoría y fabricación coordinada en la Región de Coquimbo.";
const displayName =
  name.length > 0 ? `${name[0].toUpperCase()}${name.slice(1)}` : name;
const subtitle =
  id === "cocina-personalizada" || id === "closet-personalizado"
    ? "Por metro lineal"
    : "Proyecto hecho a medida";

const structuredData = {
  "@context": "https://schema.org",
  "@type": "Product",
  name: displayName,
  image: galleryImages.map((img: string) => mapImageToAbsolute(img)),
  description,
  brand: { "@type": "Brand", name: "Mueblería El Fiorentino" },
  offers: {
    "@type": "Offer",
    priceCurrency: "CLP",
    price,
    availability: "https://schema.org/InStock",
    url: new URL(`/products/${product.slug}`, siteUrl).toString(),
  },
};
---

<Layout
  title={`${displayName} | Mueblería El Fiorentino`}
  description={metaDescription}
  image={mainImage}
  ogType="product"
  structuredData={structuredData}
>
  <section class="section-shell product-page" aria-labelledby="product-title">
    <div class="container-shell product-shell pt-[50px]">
      <div class="product-grid">
        <div class="product-gallery">
          <div class="surface-card gallery-card">
            <div
              class="media-main"
              role="region"
              aria-label={`Galería de ${displayName}`}
            >
              <div id="slider" class="slider-track">
                {
                  galleryImages.map((img: string, index: number) => (
                    <img
                      src={resolveImagePath(img)}
                      alt={`${displayName} - imagen ${index + 1}`}
                      class="product-slide"
                      loading={index === 0 ? "eager" : "lazy"}
                      decoding="async"
                      fetchpriority={index === 0 ? "high" : "low"}
                      width="960"
                      height="720"
                      aria-hidden={index === 0 ? "false" : "true"}
                    />
                  ))
                }
              </div>
              {
                galleryImages.length > 1 && (
                  <>
                    <ArrowImage direction="left" />
                    <ArrowImage direction="right" />
                  </>
                )
              }
            </div>
            <div class="gallery-meta">
              <span class="gallery-hint">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.5"
                  class="h-4 w-4"
                  aria-hidden="true"
                >
                  <circle cx="12" cy="12" r="9"></circle>
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="m9 12 2 2 4-4"></path>
                </svg>
                Haz zoom con un click
              </span>
              <span class="gallery-count">
                {galleryImages.length}
                {galleryImages.length === 1 ? "foto" : "fotos"}
              </span>
            </div>
          </div>

          {
            galleryImages.length > 1 && (
              <div
                class="thumbs"
                role="list"
                aria-label="Miniaturas del producto"
              >
                {galleryImages.map((img: string, index: number) => (
                  <button
                    type="button"
                    class={`thumb ${index === 0 ? "is-active" : ""}`}
                    data-thumb
                    data-index={index}
                    aria-pressed={index === 0 ? "true" : "false"}
                    aria-label={`Ver imagen ${index + 1} de ${displayName}`}
                  >
                    <img
                      src={resolveImagePath(img)}
                      alt={`${displayName} miniatura ${index + 1}`}
                      loading="lazy"
                      decoding="async"
                      width="180"
                      height="135"
                    />
                  </button>
                ))}
              </div>
            )
          }
        </div>

        <div class="product-info">
          <div class="info-card surface-card">
            <div class="eyebrow">Mueble a medida</div>
            <h1 id="product-title" class="product-title">
              {displayName}
            </h1>
            {subtitle && <p class="product-subtitle">{subtitle}</p>}

            <div class="price-block">
              <div>
                <p class="price-label">{priceHeading}</p>
                <p class="price-value">{priceValue}</p>
              </div>
              <p class="price-note">{priceNote}</p>
            </div>

            <p class="description">{description}</p>

            <ul class="benefits-list" role="list">
              <li class="benefit">
                <span class="benefit-icon" aria-hidden="true">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    class="h-4 w-4"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="m5 13 4 4L19 7"></path>
                  </svg>
                </span>
                <span class="benefit-text"
                  >Diseños a medida en melamina de alta resistencia.</span
                >
              </li>
              <li class="benefit">
                <span class="benefit-icon" aria-hidden="true">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    class="h-4 w-4"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M5 12h14M5 12l3.5-3.5M5 12l3.5 3.5"></path>
                  </svg>
                </span>
                <span class="benefit-text"
                  >Instalación y despacho coordinados en Región de Coquimbo.</span
                >
              </li>
              <li class="benefit">
                <span class="benefit-icon" aria-hidden="true">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.5"
                    class="h-4 w-4"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M9 5h6a2 2 0 0 1 2 2v10l-5-3-5 3V7a2 2 0 0 1 2-2Z"
                    ></path>
                  </svg>
                </span>
                <span class="benefit-text"
                  >Correderas telescópicas y terminaciones pensadas para durar.</span
                >
              </li>
            </ul>

            <form
              class="product-form"
              id="productForm"
              data-product-name={displayName}
            >
              <input name="Name" value={displayName} hidden />
              <input name="id" value={id} hidden />
              <div
                class={`input-grid ${showDimensions ? "input-grid--split" : ""}`}
              >
                {
                  showDimensions && (
                    <>
                      <LabelCustomize type="number" name="Alto" />
                      <LabelCustomize type="number" name="Largo" />
                      <LabelCustomize type="number" name="Ancho" />
                    </>
                  )
                }
                {
                  shouldAskDrawers && (
                    <LabelCustomize type="number" name="Cajones" />
                  )
                }
              </div>

              <div class="tones">
                <div class="tones-header">
                  <p class="tones-title">Color</p>
                  <span class="tones-helper">Requerido antes de cotizar</span>
                </div>
                {
                  tones?.colors?.length ? (
                    <div
                      class="swatches"
                      role="radiogroup"
                      aria-label="Colores disponibles"
                    >
                      {tones.colors.map((color: string) => (
                        <label class="swatch" data-swatch>
                          <input
                            type="radio"
                            name="Color"
                            value={color}
                            required
                          />
                          <span class="swatch-dot" aria-hidden="true" />
                          <span>
                            <span class="swatch-label">{color}</span>
                            <small>Acabado sugerido</small>
                          </span>
                        </label>
                      ))}
                    </div>
                  ) : (
                    <select
                      name="Color"
                      id="tones-select"
                      required
                      class="tone-select"
                    >
                      <option value="" selected>
                        Selecciona un color
                      </option>
                    </select>
                  )
                }
              </div>

              <div class="cta-stack">
                <button
                  type="submit"
                  class="btn btn-whatsapp btn-premium cta-primary"
                >
                  <img
                    src="/socialmedia/whatsappButton.svg"
                    alt=""
                    aria-hidden="true"
                    loading="lazy"
                    decoding="async"
                    width="24"
                    height="24"
                  />
                  Cotizar por WhatsApp
                </button>
                <p class="cta-note">
                  Te respondemos rápido. Incluye instalación en Región de
                  Coquimbo.
                </p>
                <a
                  class="cta-secondary"
                  href="/"
                  aria-label="Volver al catálogo"
                >
                  Ver catálogo
                </a>
              </div>
            </form>
          </div>

          <div class="trust-card surface-card">
            <div class="eyebrow">Incluye / Información</div>
            <h2 class="product-subtitle">
              Tu proyecto, acompañado de principio a fin.
            </h2>
            <ul class="trust-list" role="list">
              <li class="trust-item">
                <span class="trust-icon" aria-hidden="true">✓</span>
                <div>
                  <p class="trust-title">Fabricación a medida</p>
                  <p class="trust-copy">
                    Diseño personalizado según espacio y estilo.
                  </p>
                </div>
              </li>
              <li class="trust-item">
                <span class="trust-icon" aria-hidden="true">✓</span>
                <div>
                  <p class="trust-title">Instalación coordinada</p>
                  <p class="trust-copy">
                    Agendamos contigo para una entrega sin sorpresas.
                  </p>
                </div>
              </li>
              <li class="trust-item">
                <span class="trust-icon" aria-hidden="true">✓</span>
                <div>
                  <p class="trust-title">Garantía y soporte</p>
                  <p class="trust-copy">
                    Acompañamiento post venta para ajustes o dudas.
                  </p>
                </div>
              </li>
              <li class="trust-item">
                <span class="trust-icon" aria-hidden="true">✓</span>
                <div>
                  <p class="trust-title">Cobertura</p>
                  <p class="trust-copy">Región de Coquimbo y alrededores.</p>
                </div>
              </li>
              <li class="trust-item">
                <span class="trust-icon" aria-hidden="true">✓</span>
                <div>
                  <p class="trust-title">Tiempos estimados</p>
                  <p class="trust-copy">
                    A definir según medidas y complejidad del proyecto.
                  </p>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div id="lightbox" class="lightbox" aria-hidden="true">
    <div class="lightbox__backdrop" data-lightbox-close></div>
    <div class="lightbox__body">
      <div class="lightbox__close">
        <button
          type="button"
          aria-label="Cerrar imagen ampliada"
          data-lightbox-close
        >
          ✕
        </button>
      </div>
      <img id="lightbox-image" alt="" loading="lazy" decoding="async" />
    </div>
  </div>

  <div class="mobile-sticky">
    <button
      type="button"
      class="btn btn-whatsapp btn-premium"
      data-sticky-whatsapp
      aria-label="Cotizar por WhatsApp"
    >
      <img
        src="/socialmedia/whatsappButton.svg"
        alt=""
        aria-hidden="true"
        loading="lazy"
        decoding="async"
        width="24"
        height="24"
      />
      Cotizar por WhatsApp
    </button>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const slider = document.getElementById("slider");
      const slides = slider ? Array.from(slider.querySelectorAll("img")) : [];
      const prevButton = document.getElementById("prev");
      const nextButton = document.getElementById("next");
      const thumbnails = Array.from(document.querySelectorAll("[data-thumb]"));

      const totalImages = slides.length;
      let index = 0;

      const setActiveSlide = (newIndex) => {
        if (!slider || totalImages === 0) return;
        index = (newIndex + totalImages) % totalImages;
        const offset = -index * 100;
        slider.style.transform = `translateX(${offset}%)`;
        slides.forEach((slide, slideIndex) => {
          slide.setAttribute(
            "aria-hidden",
            slideIndex === index ? "false" : "true",
          );
        });
        thumbnails.forEach((thumb, thumbIndex) => {
          thumb.classList.toggle("is-active", thumbIndex === index);
          thumb.setAttribute(
            "aria-pressed",
            thumbIndex === index ? "true" : "false",
          );
        });
      };

      if (slider && totalImages > 0) {
        setActiveSlide(0);
      }

      prevButton?.addEventListener("click", () => setActiveSlide(index - 1));
      nextButton?.addEventListener("click", () => setActiveSlide(index + 1));

      let touchStartX = 0;
      let touchEndX = 0;

      slider?.addEventListener(
        "touchstart",
        (e) => {
          touchStartX = e.changedTouches[0].screenX;
        },
        { passive: true },
      );

      slider?.addEventListener(
        "touchend",
        (e) => {
          touchEndX = e.changedTouches[0].screenX;
          const swipeThreshold = 50;
          if (touchEndX < touchStartX - swipeThreshold) {
            setActiveSlide(index + 1);
          }

          if (touchEndX > touchStartX + swipeThreshold) {
            setActiveSlide(index - 1);
          }
        },
        { passive: true },
      );

      thumbnails.forEach((thumb, thumbIndex) => {
        thumb.addEventListener("click", () => setActiveSlide(thumbIndex));
        thumb.addEventListener("keydown", (event) => {
          if (event.key === "Enter" || event.key === " ") {
            event.preventDefault();
            setActiveSlide(thumbIndex);
          }
        });
      });

      const swatches = Array.from(document.querySelectorAll("[data-swatch]"));
      const syncSwatches = () => {
        swatches.forEach((swatch) => {
          const input = swatch.querySelector("input");
          swatch.classList.toggle("is-active", Boolean(input?.checked));
        });
      };
      swatches.forEach((swatch) => {
        const input = swatch.querySelector("input");
        input?.addEventListener("change", syncSwatches);
      });
      syncSwatches();

      const lightbox = document.getElementById("lightbox");
      const lightboxImage = document.getElementById("lightbox-image");
      const openLightbox = (img) => {
        if (!lightbox || !(img instanceof HTMLImageElement) || !lightboxImage)
          return;
        lightboxImage.src = img.src;
        lightboxImage.alt = img.alt;
        lightbox.classList.add("is-open");
        lightbox.setAttribute("aria-hidden", "false");
        document.body.classList.add("modal-open");
      };
      const closeLightbox = () => {
        if (!lightbox) return;
        lightbox.classList.remove("is-open");
        lightbox.setAttribute("aria-hidden", "true");
        document.body.classList.remove("modal-open");
      };

      slider?.addEventListener("click", (event) => {
        const target = event.target;
        openLightbox(target);
      });

      lightbox?.addEventListener("click", (event) => {
        const target = event.target;
        if (
          target &&
          target.dataset &&
          target.dataset.lightboxClose !== undefined
        ) {
          closeLightbox();
        }
      });
      document.addEventListener("keydown", (event) => {
        if (event.key === "Escape") {
          closeLightbox();
        }
      });

      const form = document.getElementById("productForm");
      form?.addEventListener("submit", (event) => {
        event.preventDefault();
        const formElement = event.target;
        if (!(formElement instanceof HTMLFormElement)) return;

        const formData = new FormData(formElement);
        const data = Object.fromEntries(formData.entries());

        const baseName =
          (data.Name?.toString() ?? "").replace(/[^\p{L}\p{N}\s]/gu, "") ||
          formElement.dataset.productName ||
          "";
        const includeDimensions =
          data.id !== "cocina-personalizada" &&
          data.id !== "closet-personalizado";

        const parts: string[] = [];
        if (includeDimensions) {
          if (data.Alto) parts.push(`Alto ${data.Alto}`);
          if (data.Largo) parts.push(`Largo ${data.Largo}`);
          if (data.Ancho) parts.push(`Ancho ${data.Ancho}`);
          if (data.Cajones) parts.push(`Cajones ${data.Cajones}`);
        } else if (data.Cajones) {
          parts.push(`Cajones ${data.Cajones}`);
        }
        if (data.Color) {
          parts.push(`Color ${data.Color}`);
        }

        const specs =
          parts.length > 0
            ? ` con las especificaciones: ${parts.join(", ")}.`
            : "";

        const message = `Hola, me interesa el producto ${baseName}${specs} ¿Podrías darme más información?`;
        const whatsappURL = `https://wa.me/56974061736?text=${encodeURIComponent(message)}`;
        window.open(whatsappURL, "_blank", "noreferrer");
      });

      const stickyCTA = document.querySelector("[data-sticky-whatsapp]");
      stickyCTA?.addEventListener("click", () => {
        const formElement = document.getElementById("productForm");
        formElement?.requestSubmit();
      });
    });
  </script>

  <style>
    .product-shell {
      display: grid;
      gap: var(--space-3);
    }

    .product-grid {
      display: grid;
      gap: var(--space-3);
    }

    @media (min-width: 1024px) {
      .product-grid {
        grid-template-columns: 1.05fr 0.95fr;
        align-items: start;
      }

      .product-gallery {
        position: sticky;
        top: 110px;
      }
    }

    .gallery-card {
      padding: var(--space-2);
      border-radius: var(--radius-xl);
      border: 1px solid var(--color-border);
      background: linear-gradient(180deg, #ffffff 0%, #f8f3eb 100%);
      box-shadow: var(--shadow-soft);
      display: grid;
      gap: var(--space-1-5);
    }

    .media-main {
      position: relative;
      border-radius: calc(var(--radius-xl) - 6px);
      overflow: hidden;
      background: #f6f0e6;
      aspect-ratio: 4 / 3;
    }

    .slider-track {
      display: flex;
      height: 100%;
      width: 100%;
      transition: transform 280ms ease;
      will-change: transform;
    }

    .product-slide {
      flex: 0 0 100%;
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: calc(var(--radius-xl) - 6px);
      cursor: zoom-in;
    }

    .product-slide:focus-visible {
      outline: 2px solid var(--color-accent);
      outline-offset: -2px;
    }

    .gallery-meta {
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: var(--color-ink-soft);
      font-size: 0.95rem;
      gap: var(--space-1);
    }

    .gallery-hint {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .thumbs {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
      gap: var(--space-1);
    }

    .thumb {
      position: relative;
      overflow: hidden;
      border-radius: var(--radius-md);
      border: 1px solid var(--color-border);
      padding: 4px;
      background: #fff;
      transition:
        border-color 180ms ease,
        box-shadow 180ms ease,
        transform 160ms ease;
    }

    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: calc(var(--radius-md) - 4px);
      display: block;
    }

    .thumb:focus-visible {
      outline: 2px solid var(--color-accent);
      outline-offset: 2px;
    }

    .thumb.is-active {
      border-color: var(--color-accent);
      box-shadow: 0 10px 26px rgba(17, 17, 17, 0.12);
      transform: translateY(-1px);
    }

    .info-card {
      border-radius: var(--radius-xl);
      border: 1px solid var(--color-border);
      box-shadow: var(--shadow-card);
      padding: clamp(20px, 3vw, 32px);
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
    }

    .eyebrow {
      text-transform: uppercase;
      letter-spacing: 0.18em;
      font-size: 0.78rem;
      color: var(--color-ink-soft);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .product-title {
      font-family: var(--font-heading);
      font-size: clamp(1.8rem, 3vw, 2.5rem);
      line-height: 1.1;
      margin: 0;
      color: var(--color-ink);
    }

    .product-subtitle {
      margin: 4px 0 0;
      color: var(--color-ink-soft);
      font-weight: 700;
    }

    .price-block {
      display: flex;
      flex-wrap: wrap;
      gap: 12px 16px;
      align-items: center;
      padding: 14px 16px;
      border-radius: var(--radius-lg);
      background: linear-gradient(
        120deg,
        rgba(199, 155, 63, 0.08),
        rgba(255, 255, 255, 0.92)
      );
      border: 1px solid var(--color-border);
    }

    .price-label {
      font-size: 0.92rem;
      color: var(--color-ink-soft);
      margin: 0;
    }

    .price-value {
      font-size: clamp(1.4rem, 3vw, 1.8rem);
      font-weight: 800;
      color: var(--color-ink);
      margin: 2px 0 0;
    }

    .price-note {
      margin: 0;
      font-size: 0.95rem;
      color: var(--color-ink-soft);
      max-width: 28ch;
    }

    .description {
      color: var(--color-ink);
      line-height: 1.7;
      max-width: 68ch;
      margin: 0;
    }

    .benefits-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 6px;
    }

    .benefit {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 10px;
      align-items: start;
      padding: 10px 0;
      border-bottom: 1px solid var(--color-border);
    }

    .benefit:last-child {
      border-bottom: none;
    }

    .benefit-icon {
      height: 28px;
      width: 28px;
      border-radius: 999px;
      background: rgba(199, 155, 63, 0.14);
      color: var(--color-ink);
      display: grid;
      place-items: center;
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
    }

    .benefit-text {
      font-size: 0.98rem;
      color: var(--color-ink);
    }

    .product-form {
      display: flex;
      flex-direction: column;
      gap: var(--space-2);
    }

    .input-grid {
      display: grid;
      gap: var(--space-1-5);
      grid-template-columns: 1fr;
    }

    .input-grid--split {
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    .tones {
      display: grid;
      gap: 10px;
    }

    .tones-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
    }

    .tones-title {
      margin: 0;
      font-weight: 700;
      color: var(--color-ink);
    }

    .tones-helper {
      font-size: 0.92rem;
      color: var(--color-ink-soft);
    }

    .swatches {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .swatch {
      position: relative;
      border: 1px solid var(--color-border);
      background: var(--color-surface);
      border-radius: var(--radius-lg);
      padding: 10px 12px;
      min-width: 110px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      transition:
        border-color 180ms ease,
        box-shadow 180ms ease,
        transform 160ms ease;
    }

    .swatch input {
      position: absolute;
      inset: 0;
      opacity: 0;
      pointer-events: none;
    }

    .swatch-dot {
      height: 28px;
      width: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, #f2e7d3, #d9c4a0);
      border: 1px solid var(--color-border-strong);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.7);
    }

    .swatch-label {
      font-weight: 700;
      letter-spacing: 0.01em;
    }

    .swatch small {
      display: block;
      font-size: 0.88rem;
      color: var(--color-ink-soft);
    }

    .swatch:focus-within,
    .swatch:hover {
      border-color: var(--color-accent);
      box-shadow: 0 12px 26px rgba(17, 17, 17, 0.12);
      transform: translateY(-1px);
    }

    .swatch.is-active {
      border-color: var(--color-accent);
      box-shadow: 0 12px 26px rgba(199, 155, 63, 0.25);
    }

    .swatch.is-active .swatch-dot {
      box-shadow: 0 0 0 4px rgba(199, 155, 63, 0.2);
    }

    .tone-select {
      padding: 0.85rem 1rem;
      border-radius: var(--radius-lg);
      border: 1px solid var(--color-border);
      background: var(--color-surface);
      font-size: 1rem;
      color: var(--color-ink);
    }

    .tone-select:focus-visible {
      outline: 2px solid var(--color-accent);
      outline-offset: 3px;
      border-color: var(--color-accent);
    }

    .cta-stack {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .cta-primary {
      --btn-py: 0.95rem;
      --btn-px: 1.35rem;
      justify-content: center;
      border-radius: var(--radius-lg);
      font-size: 1.05rem;
    }

    .cta-primary img {
      width: 24px;
      height: 24px;
    }

    .cta-note {
      font-size: 0.92rem;
      color: var(--color-ink-soft);
      margin: 0;
    }

    .cta-secondary {
      align-self: flex-start;
      color: var(--color-ink);
      font-weight: 700;
      font-size: 0.95rem;
      border-bottom: 1px solid var(--color-border-strong);
      padding-bottom: 4px;
      transition:
        color 160ms ease,
        border-color 160ms ease;
    }

    .cta-secondary:hover,
    .cta-secondary:focus-visible {
      color: var(--color-accent);
      border-color: var(--color-accent);
      outline: none;
    }

    .trust-card {
      margin-top: var(--space-2);
      padding: clamp(18px, 3vw, 28px);
      border-radius: var(--radius-xl);
      border: 1px solid var(--color-border);
      box-shadow: var(--shadow-card);
      display: grid;
      gap: 14px;
    }

    .trust-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 12px;
    }

    .trust-item {
      display: flex;
      gap: 12px;
      align-items: flex-start;
    }

    .trust-icon {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: #111;
      color: #f7f1e6;
      display: grid;
      place-items: center;
      font-size: 0.92rem;
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.14);
    }

    .trust-title {
      margin: 0;
      font-weight: 800;
      color: var(--color-ink);
    }

    .trust-copy {
      margin: 4px 0 0;
      font-size: 0.95rem;
      color: var(--color-ink-soft);
    }

    .mobile-sticky {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 48;
      padding: 10px max(var(--content-padding), env(safe-area-inset-left));
      padding-right: max(var(--content-padding), env(safe-area-inset-right));
      background: linear-gradient(
        180deg,
        rgba(250, 248, 243, 0) 0%,
        rgba(250, 248, 243, 0.92) 40%,
        rgba(250, 248, 243, 0.96) 100%
      );
      backdrop-filter: blur(12px);
      display: grid;
    }

    .mobile-sticky .btn {
      border-radius: var(--radius-lg);
    }

    @media (min-width: 768px) {
      .mobile-sticky {
        display: none;
      }
    }

    .lightbox {
      position: fixed;
      inset: 0;
      z-index: 50;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(17, 17, 17, 0.7);
      backdrop-filter: blur(6px);
      padding: 18px;
    }

    .lightbox.is-open {
      display: flex;
    }

    .lightbox__body {
      position: relative;
      max-width: min(1100px, 92vw);
      max-height: 88vh;
    }

    .lightbox__body img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: var(--radius-lg);
      background: #000;
    }

    .lightbox__close button {
      height: 42px;
      width: 42px;
      border-radius: 14px;
      background: rgba(17, 17, 17, 0.75);
      color: #fdf8ed;
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: grid;
      place-items: center;
      cursor: pointer;
    }

    .lightbox__close button:focus-visible {
      outline: 2px solid var(--color-accent);
      outline-offset: 3px;
    }

    :global(.slider-arrow) {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      height: 46px;
      width: 46px;
      display: grid;
      place-items: center;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.82);
      backdrop-filter: blur(10px);
      border: 1px solid var(--color-border);
      box-shadow: var(--shadow-card);
      color: var(--color-ink);
      transition:
        background-color 140ms ease,
        box-shadow 160ms ease,
        transform 140ms ease;
    }

    :global(.slider-arrow:hover),
    :global(.slider-arrow:focus-visible) {
      background: #fff;
      box-shadow: var(--shadow-soft);
      transform: translateY(-50%) translateY(-1px);
    }

    :global(.slider-arrow--left) {
      left: 12px;
    }

    :global(.slider-arrow--right) {
      right: 12px;
    }

    :global(.slider-arrow--left svg) {
      transform: scaleX(-1);
    }

    :global(.slider-arrow svg) {
      width: 18px;
      height: 18px;
    }

    :global(body.modal-open) {
      overflow: hidden;
    }

    :global(main > a[href^="https://wa.me/56974061736"])
    {
      bottom: 86px;
    }

    @media (min-width: 768px) {
      :global(main > a[href^="https://wa.me/56974061736"])
      {
        bottom: 24px;
      }
    }
  </style>
</Layout>
